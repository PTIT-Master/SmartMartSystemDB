{{define "pages/sales/view"}}
<style>
        .invoice-details {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .items-table th {
            background-color: #007bff;
            color: white;
            border: none;
        }
        .expiry-warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 0.9rem;
        }
        .expiry-danger {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
</style>

<div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2>{{.Title}}</h2>
                    <div>
                        <a href="/sales/invoice/{{.Invoice.InvoiceID}}" class="btn btn-primary me-2">
                            <i class="fas fa-print"></i> In hóa đơn
                        </a>
                        <a href="/sales" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Quay lại
                        </a>
                    </div>
                </div>

                <!-- Invoice Header -->
                <div class="invoice-details">
                    <div class="row">
                        <div class="col-md-6">
                            <h5>Thông tin hóa đơn</h5>
                            <p><strong>Số hóa đơn:</strong> {{.Invoice.InvoiceNo}}</p>
                            <p><strong>Ngày bán:</strong> {{.Invoice.InvoiceDate | formatDate}}</p>
                            <p><strong>Nhân viên:</strong> {{.Invoice.EmployeeName}}</p>
                            <p><strong>Phương thức thanh toán:</strong> 
                                {{if .Invoice.PaymentMethod}}
                                    {{if eq (printf "%s" .Invoice.PaymentMethod) "CASH"}}Tiền mặt{{end}}
                                    {{if eq (printf "%s" .Invoice.PaymentMethod) "CARD"}}Thẻ{{end}}
                                    {{if eq (printf "%s" .Invoice.PaymentMethod) "TRANSFER"}}Chuyển khoản{{end}}
                                    {{if eq (printf "%s" .Invoice.PaymentMethod) "VOUCHER"}}Voucher{{end}}
                                {{else}}
                                    Chưa xác định
                                {{end}}
                            </p>
                        </div>
                        <div class="col-md-6">
                            <h5>Thông tin khách hàng</h5>
                            {{if .Invoice.CustomerName}}
                            <p><strong>Tên:</strong> {{.Invoice.CustomerName}}</p>
                            <p><strong>Điện thoại:</strong> {{.Invoice.CustomerPhone}}</p>
                            {{if .Invoice.CustomerEmail}}<p><strong>Email:</strong> {{.Invoice.CustomerEmail}}</p>{{end}}
                            {{if .Invoice.MembershipLevel}}<p><strong>Thành viên:</strong> {{.Invoice.MembershipLevel}}</p>{{end}}
                            {{if gt .Invoice.PointsEarned 0}}<p><strong>Điểm tích lũy:</strong> +{{.Invoice.PointsEarned}} điểm</p>{{end}}
                            {{if gt .Invoice.PointsUsed 0}}<p><strong>Điểm sử dụng:</strong> -{{.Invoice.PointsUsed}} điểm</p>{{end}}
                            {{else}}
                            <p><em>Khách hàng lẻ</em></p>
                            {{end}}
                        </div>
                    </div>
                </div>

                <!-- Items Table -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Chi tiết sản phẩm</h5>
                    </div>
                    <div class="card-body p-0">
                        <table class="table table-bordered mb-0">
                            <thead>
                                <tr>
                                    <th width="5%">STT</th>
                                    <th width="15%">Mã SP</th>
                                    <th width="25%">Tên sản phẩm</th>
                                    <th width="10%">Danh mục</th>
                                    <th width="10%">Quầy</th>
                                    <th width="8%">SL</th>
                                    <th width="12%">Đơn giá</th>
                                    <th width="15%">Thành tiền</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{range $index, $item := .Items}}
                                <tr>
                                    <td class="text-center">{{add $index 1}}</td>
                                    <td>{{$item.ProductCode}}</td>
                                    <td>
                                        {{$item.ProductName}}
                                        {{if $item.ExpiryDate}}
                                        <br>
                                        <small class="text-muted">HSD: {{$item.ExpiryDate.Format "02/01/2006"}}</small>
                                        {{end}}
                                    </td>
                                    <td>{{$item.CategoryName}}</td>
                                    <td>{{$item.ShelfName}}</td>
                                    <td class="text-center">{{$item.Quantity}}</td>
                                    <td class="text-end">{{$item.UnitPrice | formatCurrency}}</td>
                                    <td class="text-end">{{$item.Subtotal | formatCurrency}}</td>
                                </tr>
                                {{end}}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Totals -->
                <div class="row mt-4">
                    <div class="col-md-6">
                        {{if .Invoice.Notes}}
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">Ghi chú</h6>
                            </div>
                            <div class="card-body">
                                <p>{{.Invoice.Notes}}</p>
                            </div>
                        </div>
                        {{end}}
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">Tổng kết</h6>
                            </div>
                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <span>Tạm tính:</span>
                                    <span>{{.Invoice.Subtotal | formatCurrency}}</span>
                                </div>
                                {{if gt .Invoice.DiscountAmount 0.0}}
                                <div class="d-flex justify-content-between">
                                    <span>Giảm giá:</span>
                                    <span class="text-danger">-{{.Invoice.DiscountAmount | formatCurrency}}</span>
                                </div>
                                {{end}}
                                {{if gt .Invoice.TaxAmount 0.0}}
                                <div class="d-flex justify-content-between">
                                    <span>Thuế VAT (10%):</span>
                                    <span>{{.Invoice.TaxAmount | formatCurrency}}</span>
                                </div>
                                {{end}}
                                {{if gt .Invoice.PointsUsed 0}}
                                <div class="d-flex justify-content-between">
                                    <span>Điểm sử dụng:</span>
                                    <span class="text-info">-{{.Invoice.PointsUsed}} điểm</span>
                                </div>
                                {{end}}
                                <hr>
                                <div class="d-flex justify-content-between">
                                    <strong>TỔNG CỘNG:</strong>
                                    <strong class="text-primary">{{.Invoice.TotalAmount | formatCurrency}}</strong>
                                </div>
                                {{if gt .Invoice.PointsEarned 0}}
                                <div class="d-flex justify-content-between mt-2">
                                    <span class="text-success">Điểm tích lũy:</span>
                                    <span class="text-success">+{{.Invoice.PointsEarned}} điểm</span>
                                </div>
                                {{end}}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</div>
{{end}}
